name: Config Refresh

on:
  push:
    branches: [main]
    paths:
      - 'src/main/resources/config/**/*.yaml'
      - 'src/main/resources/config/**/*.yml'
      - 'src/main/resources/config/**/*.properties'

jobs:
  refresh-config:
    runs-on: ubuntu-latest

    steps:
      - name: Trigger Bus Refresh
        run: |
          CONFIG_SERVER_URL="${{ secrets.CONFIG_SERVER_URL || 'http://localhost:8888' }}"

          STATUS=$(curl -o /dev/null -s -w "%{http_code}" \
            -X POST "$CONFIG_SERVER_URL/actuator/busrefresh" \
            --connect-timeout 5 \
            --max-time 15)

          case "$STATUS" in
            200|204)
              echo "Config refresh triggered (status=$STATUS)"
              exit 0
              ;;
            *)
              echo "Config refresh failed (status=$STATUS)"
              exit 1
              ;;
          esac
